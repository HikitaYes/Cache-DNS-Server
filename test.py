import unittest
from server import DNSserver

class Test(unittest.TestCase):
    global dns
    dns = DNSserver()

    def testParseIP(self):
        data = b'\x00\x02\x81\x80\x00\x01\x00\x04\x00\x00\x00\x00\x06yandex\x02ru\x00\x00\x01\x00\x01\xc0\x0c\x00\x01\x00\x01\x00\x00\x00D\x00\x04\x05\xff\xff\x05\xc0\x0c\x00\x01\x00\x01\x00\x00\x00D\x00\x04\x05\xff\xff2\xc0\x0c\x00\x01\x00\x01\x00\x00\x00D\x00\x04MX72\xc0\x0c\x00\x01\x00\x01\x00\x00\x00D\x00\x04MX77'
        name, qType, nextByte = dns.parseQuestion(data[12:])
        results, TTL = dns.parseResponse(data, nextByte)

        self.assertEqual(name, b'\x06yandex\x02ru\x00')
        self.assertEqual(qType[1], 1)
        self.assertEqual(TTL[3], 68)
        self.assertEqual(results, [b'\x05\xff\xff\x05', b'\x05\xff\xff2', b'MX72', b'MX77'])

    def testParseNS(self):
        data = b'\x00\x02\x81\x80\x00\x01\x00\x03\x00\x00\x00\x00\x06yandex\x02ru\x00\x00\x02\x00\x01\xc0\x0c\x00\x02\x00\x01\x00\x00TY\x00\x06\x03ns1\xc0\x0c\xc0\x0c\x00\x02\x00\x01\x00\x00TY\x00\x14\x03ns9\nz5h64q92x9\x03net\x00\xc0\x0c\x00\x02\x00\x01\x00\x00TY\x00\x06\x03ns2\xc0\x0c'
        result = [b'\x03ns1\xc0\x0c', b'\x03ns9\nz5h64q92x9\x03net\x00', b'\x03ns2\xc0\x0c']
        TTL = b'\x00\x00TY'
        self.assertEqual(dns.parseResponse(data, 15), (result, TTL))

if __name__ == '__main__':
    unittest.main()